<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/globals.css" />
    <link rel="stylesheet" href="../css/styleguide.css" />
    <link rel="stylesheet" href="../css/StudentProfile.css" />
  </head>
  <body>
    <div class="khai-thongtincanhan">
      <div class="top-bar">
        <div class="background"></div>
        <div class="logo"></div>
        <p class="name"><span class="text-wrapper">NGUYỄN VĂN A | </span> <span class="span">Tutor</span></p>
        <div class="div">Tutor System</div>
        <div class="text-wrapper-2">☰</div>
        <img class="bk-logo" src="../images/logo.png" />
      </div>
      <div class="frame">
        <div class="w-full h-[82px] bg-[#d9d9d9] flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 sm:px-6 py-2 sm:py-0 gap-2 sm:gap-0">
          <span class="font-bold text-[16px] sm:text-[20px] text-black cursor-pointer">← Trở về trang trước</span>
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4">
            <span class="font-bold text-[14px] sm:text-[18px] lg:text-[20px] text-black whitespace-nowrap">Thời điểm cập nhật gần nhất: 29/10/2025 12:50:01</span>
            <span class="font-bold text-[16px] sm:text-[20px] underline text-black cursor-pointer" id="editInfoBtn">Chỉnh sửa thông tin</span>
          </div>
        </div>
      </div>
      <div class="side-bar">
        <div class="background-2"></div>
        <div class="row">
          <div class="text-wrapper-5">☰</div>
          <div class="text">Buổi học</div>
          <div class="text-wrapper-6">&gt;</div>
        </div>
        <div class="row-2">
          <div class="text-wrapper-5">☰</div>
          <div class="text">Thư viện</div>
          <div class="text-wrapper-6">&gt;</div>
        </div>
        <div class="row-3">
          <div class="text-wrapper-7">☰</div>
          <div class="text-2">Trang chủ</div>
          <div class="text-wrapper-8">&gt;</div>
        </div>
        <div class="row-4">
          <div class="text-3">Thông tin Tutor</div>
          <div class="text-wrapper-9">&gt;</div>
          <div class="text-wrapper-10">☰</div>
        </div>
      </div>
      <div class="MAIN-CONTENT">
        <!-- Container chính với background #fbfafa -->
        <div class="w-full min-h-screen bg-[#fbfafa] p-4 sm:p-6">
          <!-- Section: Thông tin cá nhân -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Thông tin cá nhân</span>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6">
            <!-- Cột 1: Chỉ có avatar -->
            <div class="flex items-start justify-center md:justify-start">
              <img class="w-full max-w-[166px] h-auto sm:h-[231px] object-cover rounded" src="../images/avatar.png" alt="Ảnh tutor" />
            </div>

            <!-- Cột 2: Thông tin cơ bản -->
            <div class="space-y-4">
              <div>
                <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Họ và tên</span>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">Nguyễn Văn A</div>
              </div>
              <div>
                <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Mã số tutor</span>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">22115xx</div>
              </div>
            </div>

            <!-- Cột 3: Thông tin chuyên môn -->
            <div class="space-y-4">
              <div>
                <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Lĩnh vực</span>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">Công nghệ phần mềm</div>
              </div>
              <div>
                <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Tình trạng tutor</span>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">Giảng dạy</div>
              </div>
            </div>

            <!-- Cột 4: Trống hoặc thông tin bổ sung -->
            <div class="space-y-4">
                <div>
                    <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Khoa</span>
                    <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">KH MT</div>
                  </div>
            </div>
          </div>

          <!-- Section: Thông tin liên lạc -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Thông tin liên lạc</span>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-6">
            <div>
              <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Số điện thoại</span>
              <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">0859809xxx</div>
            </div>
            <div>
              <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Email sinh viên</span>
              <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1 break-words">A.nguyenvan@hcmut.edu.vn</div>
            </div>
          </div>

          <!-- Section: Hỗ trợ -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Hỗ trợ</span>
          </div>

          <div class="mb-6">
            <div class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black mb-2">Hỗ trợ</div>
            <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black whitespace-pre-line" id="supportDisplay">
              <!-- Danh sách sẽ được hiển thị bằng JavaScript -->
            </div>
          </div>

          <!-- Section: Lịch rảnh -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Lịch rảnh</span>
          </div>

          <div class="mb-6">
            <div class="overflow-x-auto">
              <table class="w-full border-collapse border border-gray-300">
                <thead>
                  <tr class="bg-[#3c8dbc] text-white">
                    <th class="border border-gray-300 px-4 py-2 text-left font-bold text-[16px] sm:text-[18px] lg:text-[20px]">Thứ</th>
                    <th class="border border-gray-300 px-4 py-2 text-left font-bold text-[16px] sm:text-[18px] lg:text-[20px]">Tiết</th>
                    <th class="border border-gray-300 px-4 py-2 text-left font-bold text-[16px] sm:text-[18px] lg:text-[20px]">Tuần</th>
                  </tr>
                </thead>
                <tbody id="scheduleTableBody">
                  <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Section: Tài liệu tham khảo -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Tài liệu tham khảo</span>
          </div>

          <div class="mb-6">
            <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black" id="referenceMaterials">
              <!-- Danh sách tài liệu sẽ được hiển thị bằng JavaScript -->
            </div>
          </div>

          <!-- Section: Đánh giá và thống kê -->
          <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
            <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Đánh giá và thống kê</span>
          </div>

          <div class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
              <div>
                <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Số buổi hướng dẫn</span>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1" id="totalSessions">19</div>
              </div>
            </div>
            <div>
              <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Điểm đánh giá trung bình</span>
              <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black mt-1">4.1/5 (19 lượt đánh giá)</div>
            </div>
            <div>
              <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-black">Nhận xét</span>
              <div class="space-y-2 mt-2" id="commentsList">
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black">Tận tâm - Sinh viên A</div>
                <div class="font-normal text-[16px] sm:text-[20px] lg:text-[24px] text-black">Nhiệt huyết - Sinh viên B</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="bottom-bar">
        <div class="background-3"></div>
        <p class="disclaimer">
          <span class="text-wrapper-37">This is a third party software.<br /></span>
          <span class="text-wrapper-38">All rights belong to Ho Chi Minh University of Technology</span>
        </p>
        <p class="version"><span class="text-wrapper-39">Version </span> <span class="text-wrapper-40">0.1.0</span></p>
      </div>
    </div>

    <!-- Modal Chỉnh sửa thông tin -->
    <div class="modal-overlay" id="editModal">
      <div class="modal-content">
        <div class="modal-title">Chỉnh sửa thông tin</div>
        
        <div class="modal-section">
          <div class="section-title">Hỗ trợ</div>
          <div class="input-group">
            <div class="input-field">
              <label for="supportTitle">Tiêu đề</label>
              <input type="text" id="supportTitle" class="form-input" placeholder="Nhập tiêu đề hỗ trợ" />
            </div>
            <div class="input-field">
              <label for="supportSubject">Môn học</label>
              <div class="autocomplete-wrapper">
                <input type="text" id="supportSubject" class="form-input" placeholder="Nhập hoặc chọn môn học" autocomplete="off" />
                <div class="autocomplete-dropdown" id="subjectDropdown"></div>
              </div>
            </div>
            <button class="btn-add" id="addSupportBtn">Add</button>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Danh sách hỗ trợ</div>
          <div class="support-list" id="supportList">
            <!-- Danh sách sẽ được thêm bằng JavaScript -->
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Lịch rảnh</div>
          <div class="input-group">
            <div class="input-field">
              <label for="scheduleDay">Thứ</label>
              <select id="scheduleDay" class="form-input">
                <option value="">Chọn thứ</option>
                <option value="2">Thứ 2</option>
                <option value="3">Thứ 3</option>
                <option value="4">Thứ 4</option>
                <option value="5">Thứ 5</option>
                <option value="6">Thứ 6</option>
                <option value="7">Thứ 7</option>
                <option value="8">Chủ nhật</option>
              </select>
            </div>
            <div class="input-field">
              <label for="scheduleTime">Thời gian</label>
              <input type="text" id="scheduleTime" class="form-input" placeholder="VD: 7-9" />
            </div>
            <div class="input-field">
              <label for="scheduleWeeks">Tuần</label>
              <input type="text" id="scheduleWeeks" class="form-input" placeholder="VD: 1|2||||4|||||||1" />
            </div>
            <button class="btn-add" id="addScheduleBtn">Add</button>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Danh sách lịch rảnh</div>
          <div class="support-list" id="scheduleList">
            <!-- Danh sách sẽ được thêm bằng JavaScript -->
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-secondary" id="cancelBtn">Hủy</button>
          <button class="btn-secondary" id="saveBtn">Lưu thay đổi</button>
        </div>
      </div>
    </div>

    <script>
      // Danh sách môn học có sẵn
      const subjectsList = [
        'Lập trình Web (CO3049)',
        'Mạng máy tính (CO3093)',
        'Nguyên lý ngôn ngữ lập trình (CO3005)',
        'Tư vấn',
        'Cấu trúc dữ liệu và giải thuật (CO2003)',
        'Cơ sở dữ liệu (CO2010)',
        'Hệ điều hành (CO2007)',
        'Lập trình hướng đối tượng (CO2004)',
        'Toán rời rạc (MA1003)',
        'Xác suất thống kê (MA1004)'
      ];

      // Dữ liệu hỗ trợ hiện tại
      let supportList = [
        { title: 'Hướng dẫn làm web', subject: 'Lập trình Web (CO3049)' },
        { title: 'Ôn cuối kì Mạng máy tính', subject: 'Mạng máy tính (CO3093)' },
        { title: 'Hướng dẫn BTL3 PPL', subject: 'Nguyên lý ngôn ngữ lập trình (CO3005)' },
        { title: 'Hướng dẫn thiết kế UI', subject: 'Lập trình Web (CO3049)' },
        { title: 'Ôn cuối kì Mạng máy tính', subject: 'Mạng máy tính (CO3093)' },
        { title: 'Hướng dẫn BTL3 PPL', subject: 'Nguyên lý ngôn ngữ lập trình (CO3005)' }
      ];

      // Dữ liệu lịch rảnh hiện tại
      let scheduleList = [
        { day: '2', time: '7-9', weeks: '1-2-14-16' }
      ];

      // DOM Elements
      const editModal = document.getElementById('editModal');
      const editInfoBtn = document.getElementById('editInfoBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const saveBtn = document.getElementById('saveBtn');
      const addSupportBtn = document.getElementById('addSupportBtn');
      const addScheduleBtn = document.getElementById('addScheduleBtn');
      const supportTitle = document.getElementById('supportTitle');
      const supportSubject = document.getElementById('supportSubject');
      const subjectDropdown = document.getElementById('subjectDropdown');
      const supportListEl = document.getElementById('supportList');
      const scheduleListEl = document.getElementById('scheduleList');
      const supportDisplay = document.getElementById('supportDisplay');
      const scheduleTableBody = document.getElementById('scheduleTableBody');
      const scheduleDay = document.getElementById('scheduleDay');
      const scheduleTime = document.getElementById('scheduleTime');
      const scheduleWeeks = document.getElementById('scheduleWeeks');

      // Mở modal
      editInfoBtn.addEventListener('click', () => {
        editModal.style.display = 'flex';
        renderSupportList();
        renderScheduleList();
      });

      // Đóng modal
      cancelBtn.addEventListener('click', () => {
        editModal.style.display = 'none';
        resetForm();
      });

      // Đóng modal khi click bên ngoài
      editModal.addEventListener('click', (e) => {
        if (e.target === editModal) {
          editModal.style.display = 'none';
          resetForm();
        }
      });

      // Autocomplete cho môn học
      supportSubject.addEventListener('input', (e) => {
        const value = e.target.value.toLowerCase().trim();
        if (value === '') {
          subjectDropdown.style.display = 'none';
          return;
        }

        const filtered = subjectsList.filter(subject => 
          subject.toLowerCase().includes(value)
        );

        if (filtered.length > 0) {
          subjectDropdown.innerHTML = filtered.map(subject => 
            `<div class="autocomplete-item" data-value="${subject}">${subject}</div>`
          ).join('');
          subjectDropdown.style.display = 'block';
        } else {
          subjectDropdown.style.display = 'none';
        }
      });

      // Chọn môn học từ dropdown
      subjectDropdown.addEventListener('click', (e) => {
        if (e.target.classList.contains('autocomplete-item')) {
          supportSubject.value = e.target.getAttribute('data-value');
          subjectDropdown.style.display = 'none';
        }
      });

      // Ẩn dropdown khi click ra ngoài
      document.addEventListener('click', (e) => {
        const autocompleteWrapper = supportSubject.closest('.autocomplete-wrapper');
        if (!autocompleteWrapper.contains(e.target)) {
          subjectDropdown.style.display = 'none';
        }
      });

      // Thêm hỗ trợ
      addSupportBtn.addEventListener('click', () => {
        const title = supportTitle.value.trim();
        const subject = supportSubject.value.trim();

        if (title === '' || subject === '') {
          alert('Vui lòng nhập đầy đủ tiêu đề và môn học');
          return;
        }

        supportList.push({ title, subject });
        renderSupportList();
        resetSupportForm();
      });

      // Thêm lịch rảnh
      addScheduleBtn.addEventListener('click', () => {
        const day = scheduleDay.value.trim();
        const time = scheduleTime.value.trim();
        const weeks = scheduleWeeks.value.trim();

        if (day === '' || time === '' || weeks === '') {
          alert('Vui lòng nhập đầy đủ thông tin lịch rảnh');
          return;
        }

        scheduleList.push({ day, time, weeks });
        renderScheduleList();
        resetScheduleForm();
      });

      // Render danh sách hỗ trợ trong modal
      function renderSupportList() {
        if (supportList.length === 0) {
          supportListEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">Chưa có hỗ trợ nào</div>';
          return;
        }

        supportListEl.innerHTML = supportList.map((item, index) => `
          <div class="support-item">
            <div class="support-item-title">${item.title}</div>
            <div class="support-item-subject">
              <span>${item.subject}</span>
              <button class="btn-delete" data-index="${index}" data-type="support">Delete</button>
            </div>
          </div>
        `).join('');
      }

      // Render danh sách lịch rảnh trong modal
      function renderScheduleList() {
        if (scheduleList.length === 0) {
          scheduleListEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">Chưa có lịch rảnh nào</div>';
          return;
        }

        scheduleListEl.innerHTML = scheduleList.map((item, index) => `
          <div class="support-item">
            <div class="support-item-title">Thứ ${item.day} - ${item.time}</div>
            <div class="support-item-subject">
              <span>${item.weeks}</span>
              <button class="btn-delete" data-index="${index}" data-type="schedule">Delete</button>
            </div>
          </div>
        `).join('');
      }

      // Xử lý xóa bằng event delegation
      supportListEl.addEventListener('click', (e) => {
        if (e.target.classList.contains('btn-delete') && e.target.getAttribute('data-type') === 'support') {
          const index = parseInt(e.target.getAttribute('data-index'));
          supportList.splice(index, 1);
          renderSupportList();
        }
      });

      scheduleListEl.addEventListener('click', (e) => {
        if (e.target.classList.contains('btn-delete') && e.target.getAttribute('data-type') === 'schedule') {
          const index = parseInt(e.target.getAttribute('data-index'));
          scheduleList.splice(index, 1);
          renderScheduleList();
        }
      });

      // Reset form hỗ trợ
      function resetSupportForm() {
        supportTitle.value = '';
        supportSubject.value = '';
        subjectDropdown.style.display = 'none';
      }

      // Reset form lịch
      function resetScheduleForm() {
        scheduleDay.value = '';
        scheduleTime.value = '';
        scheduleWeeks.value = '';
      }

      // Reset tất cả form
      function resetForm() {
        resetSupportForm();
        resetScheduleForm();
      }

      // Render danh sách hỗ trợ trên trang chính
      function renderSupportDisplay() {
        if (supportList.length === 0) {
          supportDisplay.textContent = 'Chưa có hỗ trợ nào';
          return;
        }

        supportDisplay.textContent = supportList.map(item => 
          `${item.title} - ${item.subject}`
        ).join('\n\n');
      }

      // Render bảng lịch rảnh trên trang chính
      function renderScheduleTable() {
        if (scheduleList.length === 0) {
          scheduleTableBody.innerHTML = '<tr><td colspan="3" class="border border-gray-300 px-4 py-2 text-center text-gray-500">Chưa có lịch rảnh nào</td></tr>';
          return;
        }

        scheduleTableBody.innerHTML = scheduleList.map(item => `
          <tr>
            <td class="border border-gray-300 px-4 py-2 font-normal text-[16px] sm:text-[18px] lg:text-[20px]">${item.day}</td>
            <td class="border border-gray-300 px-4 py-2 font-normal text-[16px] sm:text-[18px] lg:text-[20px]">${item.time}</td>
            <td class="border border-gray-300 px-4 py-2 font-normal text-[16px] sm:text-[18px] lg:text-[20px]">${item.weeks}</td>
          </tr>
        `).join('');
      }

      // Lưu thay đổi
      saveBtn.addEventListener('click', () => {
        // TODO: Gửi dữ liệu lên server
        alert('Đã lưu thay đổi thành công!');
        editModal.style.display = 'none';
        resetForm();
        // Cập nhật lại danh sách trên trang chính
        renderSupportDisplay();
        renderScheduleTable();
      });

      // Khởi tạo danh sách ban đầu
      renderSupportList();
      renderScheduleList();
      renderSupportDisplay();
      renderScheduleTable();
    </script>
  </body>
</html>


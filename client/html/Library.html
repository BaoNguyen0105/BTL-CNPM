<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/globals.css" />
  <link rel="stylesheet" href="../css/styleguide.css" />
  <link rel="stylesheet" href="../css/Style.css" />
</head>
<body>
  <div class="khai-thongtincanhan">
    <div class="top-bar">
      <div class="background"></div>
      <div class="logo"></div>
      <p class="name">
        <span class="text-wrapper">NGUYỄN VĂN A | </span>
        <span class="span" id="roleDisplay">Sinh viên</span>
      </p>
      <div class="div">Tutor System</div>
      <div class="text-wrapper-2">☰</div>
      <img class="bk-logo" src="../images/logo.png" />
    </div>
    <div class="frame">
      <div class="w-full h-[82px] bg-[#d9d9d9] flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 sm:px-6 py-2 sm:py-0 gap-2 sm:gap-0">
        <span class="font-bold text-[16px] sm:text-[20px] text-black cursor-pointer">← Trở về trang chủ</span>
      </div>
    </div>
    <div class="side-bar">
      <div class="background-2"></div>
      <div class="row"><div class="text-wrapper-5">☰</div><div class="text">Buổi học</div><div class="text-wrapper-6">&gt;</div></div>
      <div class="row-2"><div class="text-wrapper-5">☰</div><div class="text">Thư viện</div><div class="text-wrapper-6">&gt;</div></div>
      <div class="row-3"><div class="text-wrapper-7">☰</div><div class="text-2">Trang chủ</div><div class="text-wrapper-8">&gt;</div></div>
      <div class="row-4">
        <div class="text-3" id="sidebarTitle">Thông tin sinh viên</div>
        <div class="text-wrapper-9">&gt;</div>
        <div class="text-wrapper-10">☰</div>
      </div>
      <div class="row-5"><div class="text-wrapper-5">☰</div><div class="text">Đăng xuất</div><div class="text-wrapper-6">&gt;</div></div>
    </div>
    <div class="MAIN-CONTENT">
      <div class="w-full min-h-screen bg-[#fbfafa] p-4 sm:p-6">
        <div class="w-full h-auto min-h-[65px] bg-[#3c8dbc] flex items-center px-4 sm:px-6 py-4 mb-4">
          <span class="font-bold text-[18px] sm:text-[20px] lg:text-[24px] text-white">Thư viện tài liệu</span>
        </div>
        <div class="w-full mb-6">
          <div class="bg-white rounded-lg shadow-sm p-4 sm:p-6">
            <div class="mb-4">
              <label class="block font-bold text-[16px] sm:text-[18px] lg:text-[20px] text-black mb-2">Tìm kiếm tài liệu</label>
              <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="searchInput" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-[14px] sm:text-[16px] focus:outline-none focus:ring-2 focus:ring-[#3c8dbc] focus:border-transparent" placeholder="Nhập tên tài liệu hoặc mã môn học (VD: CO3049, Lập trình Web...)" />
                <button id="searchBtn" class="px-6 py-2 bg-[#3c8dbc] text-white font-bold text-[14px] sm:text-[16px] rounded-lg hover:bg-[#367fa9] transition-colors whitespace-nowrap">Tìm kiếm</button>
                <button id="clearSearchBtn" class="px-6 py-2 bg-gray-500 text-white font-bold text-[14px] sm:text-[16px] rounded-lg hover:bg-gray-600 transition-colors whitespace-nowrap">Xóa bộ lọc</button>
              </div>
            </div>
          </div>
        </div>
        <div class="w-full">
          <div id="documentsContainer"></div>
          <div id="noResultsMessage" class="hidden text-center py-8">
            <p class="text-[16px] sm:text-[18px] lg:text-[20px] text-gray-500">Không tìm thấy tài liệu nào phù hợp với từ khóa tìm kiếm.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="bottom-bar">
      <div class="background-3"></div>
      <p class="disclaimer">
        <span class="text-wrapper-37">This is a third party software.<br /></span>
        <span class="text-wrapper-38">All rights belong to Ho Chi Minh University of Technology</span>
      </p>
      <p class="version"><span class="text-wrapper-39">Version </span> <span class="text-wrapper-40">0.1.0</span></p>
    </div>
  </div>
  <script>
    const documentsData = [
      { subjectCode: 'CO3049', subjectName: 'Lập trình Web', documents: [
        { id: 1, title: 'Giáo trình Lập trình Web - Chương 1', author: 'Nguyễn Văn A', year: 2023, fileName: 'Giao-trinh-LTW-Chuong1.pdf', size: '2.5 MB' },
        { id: 2, title: 'Slide bài giảng HTML/CSS', author: 'Trần Thị B', year: 2024, fileName: 'Slide-HTML-CSS.pdf', size: '1.8 MB' },
        { id: 3, title: 'Bài tập thực hành JavaScript', author: 'Lê Văn C', year: 2024, fileName: 'Bai-tap-JavaScript.docx', size: '850 KB' },
        { id: 4, title: 'Tài liệu tham khảo React', author: 'Phạm Thị D', year: 2023, fileName: 'Tai-lieu-React.pdf', size: '3.2 MB' }
      ]},
      { subjectCode: 'CO3093', subjectName: 'Mạng máy tính', documents: [
        { id: 5, title: 'Giáo trình Mạng máy tính - Tập 1', author: 'Hoàng Văn E', year: 2022, fileName: 'Giao-trinh-Mang-may-tinh-Tap1.pdf', size: '4.1 MB' },
        { id: 6, title: 'Slide bài giảng TCP/IP', author: 'Vũ Thị F', year: 2024, fileName: 'Slide-TCP-IP.pdf', size: '2.3 MB' },
        { id: 7, title: 'Bài tập mạng máy tính', author: 'Đỗ Văn G', year: 2023, fileName: 'Bai-tap-Mang-may-tinh.pdf', size: '1.5 MB' }
      ]},
      { subjectCode: 'CO3005', subjectName: 'Nguyên lý ngôn ngữ lập trình', documents: [
        { id: 8, title: 'Giáo trình PPL - Chương 1-3', author: 'Bùi Văn H', year: 2023, fileName: 'Giao-trinh-PPL-Chuong1-3.pdf', size: '3.8 MB' },
        { id: 9, title: 'Slide bài giảng PPL', author: 'Ngô Thị I', year: 2024, fileName: 'Slide-PPL.pdf', size: '2.9 MB' },
        { id: 10, title: 'Tài liệu tham khảo về Compiler', author: 'Đinh Văn K', year: 2022, fileName: 'Tai-lieu-Compiler.pdf', size: '5.2 MB' }
      ]},
      { subjectCode: 'CO2003', subjectName: 'Cấu trúc dữ liệu và giải thuật', documents: [
        { id: 11, title: 'Giáo trình CTDL&GT', author: 'Lý Văn L', year: 2023, fileName: 'Giao-trinh-CTDL-GT.pdf', size: '6.5 MB' },
        { id: 12, title: 'Slide bài giảng Cây nhị phân', author: 'Trương Thị M', year: 2024, fileName: 'Slide-Cay-nhi-phan.pdf', size: '1.9 MB' },
        { id: 13, title: 'Bài tập thực hành CTDL&GT', author: 'Võ Văn N', year: 2024, fileName: 'Bai-tap-CTDL-GT.pdf', size: '2.1 MB' }
      ]},
      { subjectCode: 'CO2013', subjectName: 'Hệ cơ sở dữ liệu', documents: [
        { id: 14, title: 'Giáo trình Cơ sở dữ liệu', author: 'Phan Văn O', year: 2023, fileName: 'Giao-trinh-CSDL.pdf', size: '4.7 MB' },
        { id: 15, title: 'Slide bài giảng SQL', author: 'Dương Thị P', year: 2024, fileName: 'Slide-SQL.pdf', size: '2.4 MB' },
        { id: 16, title: 'Bài tập thực hành SQL', author: 'Hồ Văn Q', year: 2024, fileName: 'Bai-tap-SQL.pdf', size: '1.2 MB' }
      ]},
      { subjectCode: 'CO2017', subjectName: 'Hệ điều hành', documents: [
        { id: 17, title: 'Giáo trình Hệ điều hành', author: 'Tôn Văn R', year: 2022, fileName: 'Giao-trinh-HDH.pdf', size: '5.3 MB' },
        { id: 18, title: 'Slide bài giảng Process Management', author: 'Lâm Thị S', year: 2024, fileName: 'Slide-Process-Management.pdf', size: '2.6 MB' }
      ]},
      { subjectCode: 'CO2039', subjectName: 'Lập trình Nâng cao', documents: [
        { id: 19, title: 'Giáo trình OOP', author: 'Chu Văn T', year: 2023, fileName: 'Giao-trinh-OOP.pdf', size: '4.9 MB' },
        { id: 20, title: 'Slide bài giảng OOP', author: 'Mai Thị U', year: 2024, fileName: 'Slide-OOP.pdf', size: '3.1 MB' },
        { id: 21, title: 'Bài tập thực hành OOP', author: 'Đặng Văn V', year: 2024, fileName: 'Bai-tap-OOP.pdf', size: '1.8 MB' }
      ]},
      { subjectCode: 'CO1007', subjectName: 'Cấu trúc rời rạc', documents: [
        { id: 22, title: 'Giáo trình Toán rời rạc', author: 'Bành Văn X', year: 2022, fileName: 'Giao-trinh-Toan-roi-rac.pdf', size: '5.8 MB' },
        { id: 23, title: 'Slide bài giảng Logic', author: 'Cao Thị Y', year: 2024, fileName: 'Slide-Logic.pdf', size: '2.0 MB' }
      ]},
      { subjectCode: 'MT2013', subjectName: 'Xác suất và Thống kê', documents: [
        { id: 24, title: 'Giáo trình Xác suất thống kê', author: 'Lưu Văn Z', year: 2023, fileName: 'Giao-trinh-Xac-suat-thong-ke.pdf', size: '6.2 MB' },
        { id: 25, title: 'Slide bài giảng Xác suất', author: 'Tạ Thị AA', year: 2024, fileName: 'Slide-Xac-suat.pdf', size: '2.7 MB' },
        { id: 26, title: 'Bài tập Xác suất thống kê', author: 'Hà Văn BB', year: 2024, fileName: 'Bai-tap-Xac-suat-thong-ke.pdf', size: '1.6 MB' }
      ]}
    ];
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const documentsContainer = document.getElementById('documentsContainer');
    const noResultsMessage = document.getElementById('noResultsMessage');
    const urlParams = new URLSearchParams(window.location.search);
    const userRole = urlParams.get('role') || 'student';
    const isStudent = userRole === 'student';
    document.getElementById('roleDisplay').textContent = isStudent ? 'Sinh viên' : 'Tutor';
    document.getElementById('sidebarTitle').textContent = isStudent ? 'Thông tin sinh viên' : 'Thông tin Tutor';
    const searchDocuments = (searchTerm) => {
      if (!searchTerm || searchTerm.trim() === '') return documentsData;
      const term = searchTerm.toLowerCase().trim();
      const results = [];
      documentsData.forEach(subject => {
        const matchByCode = subject.subjectCode.toLowerCase().includes(term);
        const matchByName = subject.subjectName.toLowerCase().includes(term);
        const matchingDocs = subject.documents.filter(doc => 
          doc.title.toLowerCase().includes(term) || 
          doc.author.toLowerCase().includes(term) ||
          doc.year.toString().includes(term)
        );
        if (matchByCode || matchByName) results.push(subject);
        else if (matchingDocs.length > 0) results.push({ ...subject, documents: matchingDocs });
      });
      return results;
    };
    const renderDocuments = (data) => {
      if (!data || data.length === 0) {
        documentsContainer.innerHTML = '';
        noResultsMessage.classList.remove('hidden');
        return;
      }
      noResultsMessage.classList.add('hidden');
      documentsContainer.innerHTML = data.map(subject => `
        <div class="mb-6 bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="bg-[#3c8dbc] px-4 sm:px-6 py-3 sm:py-4">
            <h2 class="font-bold text-[18px] sm:text-[20px] lg:text-[22px] text-white">${subject.subjectName} (${subject.subjectCode})</h2>
          </div>
          <div class="p-4 sm:p-6">
            <div class="space-y-3">
              ${subject.documents.map(doc => `
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 sm:p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                  <div class="flex-1">
                    <div class="font-bold text-[16px] sm:text-[18px] text-black mb-1">${doc.title}</div>
                    <div class="text-[14px] sm:text-[16px] text-gray-600 mb-1">Tác giả: ${doc.author} | Năm xuất bản: ${doc.year}</div>
                    <div class="text-[14px] sm:text-[16px] text-gray-600">Kích thước: ${doc.size}</div>
                  </div>
                  <button onclick="downloadDocument(${doc.id}, '${doc.fileName}')" class="px-4 sm:px-6 py-2 bg-[#3c8dbc] text-white font-bold text-[14px] sm:text-[16px] rounded-lg hover:bg-[#367fa9] transition-colors whitespace-nowrap w-full sm:w-auto">⬇ Tải xuống</button>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `).join('');
    };
    window.downloadDocument = (docId, fileName) => {
      alert(`Đang tải xuống: ${fileName}\n\n(Tính năng này sẽ được kết nối với backend)`);
    };
    const handleSearch = () => {
      const filteredData = searchDocuments(searchInput.value);
      renderDocuments(filteredData);
    };
    searchBtn.addEventListener('click', handleSearch);
    searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSearch(); });
    clearSearchBtn.addEventListener('click', () => { searchInput.value = ''; renderDocuments(documentsData); });
    renderDocuments(documentsData);
    const navigateToPage = (page) => {
      window.location.href = `${page}${userRole ? `?role=${userRole}` : ''}`;
    };
    
    const sidebarItems = document.querySelectorAll('.row, .row-2, .row-3, .row-4');
    
    const removeActiveClass = () => {
      sidebarItems.forEach(item => item.classList.remove('active'));
    };
    
    const setActiveItem = (item) => {
      removeActiveClass();
      if (item) item.classList.add('active');
    };
    
    const setActiveByPage = () => {
      const currentPage = window.location.pathname.split('/').pop() || 'Library.html';
      if (currentPage.includes('Student schedule')) {
        setActiveItem(document.querySelector('.row'));
      } else if (currentPage.includes('Library')) {
        setActiveItem(document.querySelector('.row-2'));
      } else if (currentPage.includes('HomePage')) {
        setActiveItem(document.querySelector('.row-3'));
      } else if (currentPage.includes('Profile')) {
        setActiveItem(document.querySelector('.row-4'));
      }
    };
    
    setActiveByPage();
    
    const logout = () => {
      window.location.href = 'Login.html';
    };
    
    document.querySelector('.frame .cursor-pointer').addEventListener('click', () => navigateToPage('HomePage.html'));
    document.querySelector('.row').addEventListener('click', function() {
      setActiveItem(this);
      navigateToPage('Student schedule.html');
    });
    document.querySelector('.row-2').addEventListener('click', function() {
      setActiveItem(this);
      navigateToPage('Library.html');
    });
    document.querySelector('.row-3').addEventListener('click', function() {
      setActiveItem(this);
      navigateToPage('HomePage.html');
    });
    document.querySelector('.row-4').addEventListener('click', function() {
      setActiveItem(this);
      navigateToPage('Profile.html');
    });
    document.querySelector('.row-5').addEventListener('click', function() {
      logout();
    });
  </script>
</body>
</html>
